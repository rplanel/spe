<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/8.5.1/nouislider.min.css" />
    <link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">
    <style>
      text {font-family:'Inconsolata', monospace !important; font-size: 12px}
     svg {margin-top : 20px;}
     .bar rect {
         fill: steelblue;
     }

     .bar text {
         fill: #000;
         font: 10px sans-serif;
     }

    </style>
  </head>
  
  <body>
    <div id="main" class="container-fluid" style="padding:40px 40px 40px 40px;">
      <div class="row">
	<div class="col-md-5">
	  <div id="control-btn" class="control-cluster btn-group " role="group"></div>
	</div>
	<div id="slider-degre" class="col-md-4"></div>
      </div>
      
      <div class="row">
	<svg width="960" height="500">
	  <text y="10px" id="count-cluster"></text>
	  <g class="histogram"></g>
	  <g class="clusters"></g>
	</svg>
      </div>
      
    </div>
    
    <!-- Compressed JavaScript -->
    
    <!-- Compiled and minified JavaScript -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/8.5.1/nouislider.min.js"></script>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="data.js"></script>
    <script src="piechart.js"></script>
    <script src="parameters.js"></script>
    <script src="histogram.js"></script>
    <script src="elm.js"></script>
    <script>
     var node = document.getElementById('control-btn')
     var app = Elm.Main.embed(node);
     
     var piechart = piechart();
     var parameters = parameters();
     var histogram = histogram();
     var slider = document.getElementById('slider-degre');
     var piechartRadius = 80;
     var dataCluster = rawClusterData;
     var taxoCluster = rawRankData;


     noUiSlider.create(slider, {
         start: [1,2],
         step: 1,
         tooltips: [ true, true],
         range: {
	     'min': [0],
	     'max': [10]
         },
     });

     
     slider.noUiSlider.on('change', function(range){
         app.ports.sliderChange.send({
             'min' : parseInt(range[0]),
             'max' : parseInt(range[1])
         });
         
     });

     app.ports.dataClusters.send({
         "distanceClusters" : dataCluster,
         "taxonomicClusters": taxoCluster,
         "displayedClusters" : dataCluster,
         "parameters"       : [ parametersData ],
         "title"            : "",
         "min"              : 0.0,
         "max"              : 1.0,
         "numberOfClusters" : 0,
         "histogramData"    : [0]
         
     });

     app.ports.sliderRange.subscribe(function(range){
         slider.noUiSlider.updateOptions({
	     range: {
	         'min': range[0],
	         'max': range[1]
	     }
    });
     });
     
     app.ports.draw.subscribe(function(params){
         var data = params[0];
         var histoData = params[1];
         console.log(histoData);
         d3.select('svg').attr('height',function(d){
             return (data.length * (piechartRadius+50)) + 700;
         });

         d3.select('g.histogram').datum(histoData).call(histogram,500,500);
         
         d3.select('g.clusters')
           .attr('transform', "translate(0,300)")
           .datum(data)
           .call(piechart,piechartRadius,piechartRadius);
     });
    </script>

  </body>
</html>
